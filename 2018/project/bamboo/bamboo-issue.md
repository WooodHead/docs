# how to improve productivity - Edmund Chen 2018-8-15

   Q: Edmund
       我们很多项目都有一些共同的模块，如下：
        User & Role
        Workflow
        Dashboard
        Survey
       我们是否能用一些开源的CMS 来作为2次开发？需要用比较新的架构，microservices。

  A:  
        Role-Based Access Control 的难点在于 
           1.1 角色 ，用户，资源 在不同的项目有别
           1.2 用户的状态需要和人事的组织架构树需要同步。
               比如：在工作流中某个角色下的用户已经离职，已经分配给他（她）的任务
               该如何判断和处理
           1.3 Daimler是否同意建立一个统一的RBAC平台，按照不同的业务子系统，维护
               各自的角色 资源的定义。
         2. 工作流平台可以做成微服务的方式，不过要收到限制原因如下：
            2.1 activiti 5.15版本上提供tenant的概念
            2.2 activiti tenent的感念目前是基于shared database实现的，这就带来的
                数据量的问题。
            2.3 基于如上两点如果需要做基于微服务的框架的工作流解决方案的化可以分
                两个阶段
               2.3.1 第一阶段用5.15 版本做租户管理
               2.3.2 二次开发工作流需要做数据路由来进行分库路由

         3. dashboard 和 survey 还需要Edmund您给出具体的说明，最好能给出应用场景，
            我好查找相关的资料，再给您回复 
            
   A: Guan Xiao bing
   
      我们.net里有一种叫code first的设计默认，采用这种模式，架构人员可以先设计所
      需要的业务对象，然后通过业务对象会反向自动生成数据库，我拿用户权限微服务模
      块举例，架构师写好user，role和相关的class，并通过类的组合设置好对象之间的
      关系，然后相关框架负责分析这些class，反向生成数据库
 
      我觉得这应该是一个可行的，可以开发出来的通用框架平台。我想象的运行流程是
      第一，打开框架生成页面，选择我们可用的微服务业务模块，选择目标数据库，选择
      目标缓存等，
      第二步，根据第一步的选择，通过文件操作IO功能，按着选择的要求，读写预先制定
      好的微服务项目模板，加入相应操作框架，比如ORM，缓存操作框架，
      第三部，上传架构师预先设计的业务类文件，框架平台分析各个业务类之间的关系，
      反向生成数据库脚本并且在框架中生成必要的数据库操作通用方法，
      第四步，下载生成好的微服务框架即数据库生成脚本文件
 
      我觉得这些如果交给一个有深厚java功底的人来做是可以实现，如果利用工作间隙
      不断开发的话，一个人需要半年的时间，当然基础框架模板需要其他业务team提供
      我们这个项目完成后，抽出一套用户权限项目模板是没有问题的
      
   Q: 
    
         小兵做了非常认真的思考，提出了详细的构思，我认同小兵的设计流程。
      你设想是可以实现的，这个毫无疑问。
         对于如何提高代码编写效率，其实这是一个非常有意思的话题。
      既然谈到效率，我的理解是，产出/投入与消耗时间的评估值。其中投入和时间是关键
         我们设想一下今后的启动一个新项目后的设计和开发的流水线：
         设计开发主流程：
         1.Engineer拿到了需求开始根据自己的理解使用通用平台生成代码
         2.Engineer 开始使用的生成的脚本和代码框架完成业务代码的开发
         就以上流程请大家思考以下问题：
         1. 框架是否在项目启动前提供了足够的技术选型（数据库，缓存，ORM）
            如果没有，也不是问题的关键，暂时先不考虑。(风险，时间)
         2. 业务设计和开发代码的是否一个人完成？从业务熟悉角度讲应该一个人，
            但业务设计能力是否允许一次能到位？ 可能就需要一个设计评审(额外投入)。
            如果不能就要做在已开发业务的代码上与新设计生产的代码合并(重复投入)。
         那么开发人员如何解决生产效率问题？
         我的经验是：
         1. 领域划分
                文件存储，消息中心，支付中心等等如果有拿来用
         2. 细化需求
                让所有项目中的开发人员做白板设计，sticker出业务边界，设计和开发
            对需求都有明确的把握
         3. 接口设计优先 
                毕竟项目不是一个人完成，协作优先个人，在此基础上做MVP主流程的
            demo验证接口）
         4. 分模块开发 
             在模块上采用DB2Code）用简单代码返回正常值和异常，验证流程后在进行代
            码开发，减少重复工作
         总结：
         细化需求，接口优先，减少重复
         
         后话：
           对于DDD后的代码生成问题，是技术栈，语法分析器与模板工具的结合过程，它
         的难点不是技术而是你想做一个什么样的工具，你对他的期望值有多大的问题。
         一个越是能干出复杂的事情的(变形金刚)他本身也就复杂，如果你就想要一个钉
         钉子的工具，那么就设计一个锤子就好了。维护起来也方便，不需要较高的维护
         成本投入。    
  
#  K8S deployment diagram -  Guan xiao bing 2018-8-15s

  Q:
      1.   前后端每个微服务点在K8S中的存在形式
      2.   Build server
      3.   Git server
      4.   Docker容器仓库
      5.   相关的配置文件
      6.   相关的Docker file
      7.   如何负载
      
     首先要明确的是这条路需要我们一起来淌，
     1. 微服务存在K8S中存在的形式，这个问题和关键。
        1.1 基于KVM的好搭建，这个Derrick经验丰富，我就不多说了。
        1.2 基于Docker目前有个开源的
            shttps://github.com/spring-cloud/spring-cloud-kubernetes 
            目前版本有点低，会带来很多攻坚问题。
     2. Builder Server 需要Jenkins master-slave方案来做
     3. Git Server 是Daimler提供，不需要我们考虑，但是要求生产上如果采用KVM的方式
        配置中心又是基于Git管理，那么就有个网络互通的问题
     4. Docker容器仓库是否可以采用[harber](https://goharbor.io/)
     5. 相关的配置文件
        微服务框架是采用配置中心管理，配置文件应放在Git上
     6. 相关的Dockerfile是建议放在Git上随工程走
     7. 如何负载
        7.1 Jenkins的 负载采用Master-Slave方式
        7.2 Harbor 也是基于主从的方式提供负载（具体需要我再看看）
    
    